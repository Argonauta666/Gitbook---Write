# Arin (Coolest exploit)

Arin (Coolest exploit)

Sunday, July 3, 2022

8:16 PM

Nmap scan:

!\[\[70\_Arin (Coolest exploit)\_image001.png]]

&#x20;

Port 80:

&#x20;

!\[\[70\_Arin (Coolest exploit)\_image002.png]]

&#x20;

When trying to register, it seems that we would need to have port 25 open.

!\[\[70\_Arin (Coolest exploit)\_image003.png]]

&#x20;

Which is weird...

Anyways ARIN has a Whois database, which explains why port 43 is open.

&#x20;

We can register an account using this email and also setting up a SMTP server on our own machine. In this case, I happened to use responder.

!\[\[70\_Arin (Coolest exploit)\_image004.png]]

&#x20;

But this nothing for us.

!\[\[70\_Arin (Coolest exploit)\_image005.png]]

&#x20;

We still cannot visit the website. In this case, it would appear we need to shift to port 43 for further enumeration.

&#x20;

Port 43:

!\[\[70\_Arin (Coolest exploit)\_image006.png]]

&#x20;

It seems to take IP addresses.

!\[\[70\_Arin (Coolest exploit)\_image007.png]]

&#x20;

From here, we can try to put in a few ip addresses.

We can try putting the localhost to make the port query itself.

!\[\[70\_Arin (Coolest exploit)\_image008.png]]

&#x20;

We would need to guess this domain somehow...

&#x20;

We might need to set up an SMTPD server so that we can receive mail on our Kali machine.

&#x20;

So basically, this whois would query the new web page and see it. We can try to add a whole new IP range to the database via the account setup thing.

!\[\[70\_Arin (Coolest exploit)\_image009.png]]

&#x20;

So by setting up a Python server, we can actually receive the confirmation mail and be able to add our IP range into the database. However, we would still need to click on that mail in order to sign in to our account.

&#x20;

I can see that we do indeed receive mail on port 25 when we are registering with our own IP address.

{width="7.114583333333333in" height="1.2395833333333333in"}

&#x20;

We can use this snippet of code and then run it, being able to intercept the mail to see if it exists.

!\[\[70\_Arin (Coolest exploit)\_image0011.png]]

&#x20;

&#x20;

{width="5.552083333333333in" height="1.5625in"}

In this case, we can just take this instead, and be able to see the message length.

&#x20;

So now we at least know the message that is being sent.

We just need to be able to read that message.

&#x20;

We just need to add this one line.

!\[\[70\_Arin (Coolest exploit)\_image0013.png]]

&#x20;

Then we can resend the mail, and be able to click on the registration link.

!\[\[70\_Arin (Coolest exploit)\_image0014.png]]

&#x20;

Now that we are in, we can try to fuzz this web page.

!\[\[70\_Arin (Coolest exploit)\_image0015.png]]

&#x20;

Just take the cookie of which we used to login, and we can begin the fuzzing.

!\[\[70\_Arin (Coolest exploit)\_image0016.png]]

&#x20;

There's this logs endpoint.

!\[\[70\_Arin (Coolest exploit)\_image0017.png]]

&#x20;

{width="7.989583333333333in" height="1.8958333333333333in"}

&#x20;

Interestingly, fail2ban is here, and this seems to have some fail2ban server.

There are some fail2ban RCE online that involve using mail, and we so happened to have received the admin@arin.pg mail account.

&#x20;

Now we can try to do an RCE.

!\[\[70\_Arin (Coolest exploit)\_image0019.png]]

&#x20;

0xdf has a great writeup about this for another machine.

[https://0xdf.gitlab.io/2022/05/28/htb-admirertoo.html](https://0xdf.gitlab.io/2022/05/28/htb-admirertoo.html)

&#x20;

So we would need to control the response made on the server, of which case it would cause the whois lookup on my IP, meaning we need to start whois on our server.

&#x20;

This would mean we need to configure a whois server in order to make it communicate with my IP address, as that's the only way of which we can control the mail server stuff.

&#x20;

Firstly, we can see that we are able to query our own domain.

{width="4.96875in" height="1.2708333333333333in"}

&#x20;

!\[\[70\_Arin (Coolest exploit)\_image0021.png]]

&#x20;

Let's take a look at the website again.

&#x20;

&#x20;

!\[\[70\_Arin (Coolest exploit)\_image0022.png]]

&#x20;

The save button there is disabled, so let's try to re-enable it.

!\[\[70\_Arin (Coolest exploit)\_image0023.png]]

&#x20;

We can re-enable the disable button with no issues.

When we try to save, we can see that it basically doesn't let us.

!\[\[70\_Arin (Coolest exploit)\_image0024.png]]

&#x20;

This is because within the response, the disabled=disabled is still present. We can set Burp Proxy to remove that.

!\[\[70\_Arin (Coolest exploit)\_image0025.png]]

&#x20;

Afterwards, we can easily just configure the RWHOIS to be our IP address.

!\[\[70\_Arin (Coolest exploit)\_image0026.png]]

&#x20;

Now, we can confirm that we have a record on the server.

We can then find out the RWHOIS runs on port 4321, so meaning that when a query is made, we just need to be able to be listening on port 4321.

This would allow us to input whatever commands that we want to do.

&#x20;

We can then follow the PoC accordingly.

{width="6.09375in" height="0.96875in"}

&#x20;

This would basically inject code into our query, then we can just trigger the fail2ban thing using SSH.

This would force the server to do a whois on our IP address, and then execute that bit of code there.

&#x20;

{width="4.375in" height="1.65625in"}

&#x20;

{width="7.03125in" height="1.3020833333333333in"}

&#x20;

{width="9.854166666666666in" height="1.96875in"}

&#x20;

We now have RCE. We just need to input some reverse shell now.

{width="8.760416666666666in" height="0.9791666666666666in"}

&#x20;

{width="6.375in" height="1.90625in"}

&#x20;

{width="8.822916666666666in" height="1.375in"}

&#x20;

{width="8.604166666666666in" height="2.8229166666666665in"}

&#x20;

What an interesting exploit.

&#x20;

Flag 1:

!\[\[70\_Arin (Coolest exploit)\_image0035.png]]

&#x20;

Flag 2:

!\[\[70\_Arin (Coolest exploit)\_image0036.png]]

&#x20;

So the tricks here was identifying that we could indeed edit the whois records, and then finding out which port does rwhois query at, being able to set up a listener and then executing this.

&#x20;

This was hard, and honestly not possible without a walkthrough LOL

&#x20;

Learnt a lot about rwhois and whois, really difficult exploits with not a lot of stuff on the web about it.

&#x20;
