# Hetemit

Hetemit

Wednesday, 23 March 2022

12:00 am

A peculiar box.

!\[\[33\_Hetemit \_image001.png]]

&#x20;

!\[\[33\_Hetemit \_image002.png]]

&#x20;

!\[\[33\_Hetemit \_image003.png]]

Port 50000 just has this.

!\[\[33\_Hetemit \_image004.png]]

&#x20;

!\[\[33\_Hetemit \_image005.png]]

This seems to generate some kind of email?

&#x20;

!\[\[33\_Hetemit \_image006.png]]

And this takes a code parameter and does something with that.

&#x20;

!\[\[33\_Hetemit \_image007.png]]

&#x20;

When sending these parameters, we get some kind of confirmation hash that generates this user.

It seems to take the email parameter and does something with it, and the contents of that variable don't actually matter.

&#x20;

The verify portion seems to just take a code parameter, but I had a tough time trying to figure out what I can actually submit in there.

&#x20;

On port 18000, it seems that we have to use the invite codes generated by /generate to login for us.

&#x20;

{width="7.645833333333333in" height="9.21875in"}

When I used any email with the same code, it would allow me to create a user.

&#x20;

Interesting.

&#x20;

Then it hit me, it seems that generate is used to create these tokens, and the server must be sending them to /verify in order to see if they are real. This theory is proven somewhat accurate when I cannot submit any token to register a user.

&#x20;

From this, we can view the requests and determine that the authenticity\_token is encoded somehow.

!\[\[33\_Hetemit \_image009.png]]

This was originally our own token.

&#x20;

Now I was wondering, was it possible to pass in somekind of command or something using this? We have the tools needed to generate any token we want, and this is passed to the web server. Or could we do some HTTP smuggling?

There was also this file upload thing for avatars, could that be used as another injection too?

&#x20;

I wanted to take another look at the creation of these tokens, which do not seem to be unique at all.

&#x20;

!\[\[33\_Hetemit \_image0010.png]]

Generated this and created another user.

!\[\[33\_Hetemit \_image0011.png]]

&#x20;

!\[\[33\_Hetemit \_image0012.png]]

The windows thing there is my avatar

&#x20;

Looked at the page source for all errors and determined the user name:

{width="6.0625in" height="0.9791666666666666in"}

&#x20;

Also the tokens are SHA2-256 hashes, which is always good to know. Not too sure what I can do with this for now.

Seems that the tokens are direct hashes of whatever email we submit.

&#x20;

So we know how the web tokens are generated, now what?

&#x20;

FTP still isn't working for me, despite having the anonymous login, which I suspect is part of this thing. Otherwise there's no way.

!\[\[33\_Hetemit \_image0014.png]]

Finally this worked.

&#x20;

This seems to verify users, I think by their UID. Inputting any letters will result in failures. So this verifies numbers.

&#x20;

!\[\[33\_Hetemit \_image0015.png]]

Perhaps we can escape from this.

&#x20;

After a hint, I'm back to looking at verify. This thing can take numbers and we know that it's running **a python server.** This would mean we can inject some shells into this.

&#x20;

!\[\[33\_Hetemit \_image0016.png]]

&#x20;

!\[\[33\_Hetemit \_image0017.png]]

Damn, this was a good hint. From here we can actually execute python code into this.

!\[\[33\_Hetemit \_image0018.png]]

&#x20;

!\[\[33\_Hetemit \_image0019.png]]

&#x20;

This would mean that the id of the user is 1000.

!\[\[33\_Hetemit \_image0020.png]]

&#x20;

!\[\[33\_Hetemit \_image0021.png]]

Great.

&#x20;

!\[\[33\_Hetemit \_image0022.png]]

&#x20;

!\[\[33\_Hetemit \_image0023.png]]

&#x20;

Interesting stuff that we can do here.

&#x20;

From here, we need to find some .service files that we can write.

From there, it should be easy to just rewrite it to execute a reverse shell script and then reboot the whole system.

&#x20;

!\[\[33\_Hetemit \_image0024.png]]

This should do.

&#x20;

We can write in our own shell into the thing, and this can be done through the use of vi.

Edit the service file to this:

{width="5.0625in" height="2.2604166666666665in"}

Also, change the user to root.

!\[\[33\_Hetemit \_image0026.png]]

Then this means on executing the machine, it would execute our own shell that we can place anywhere. Remember to make the file executable.

&#x20;

From here, we just sudo /sbin/reboot and wait for the machine to port up again, and we should gain a shell.

!\[\[33\_Hetemit \_image0027.png]]

&#x20;

{width="8.166666666666666in" height="4.65625in"}

&#x20;
