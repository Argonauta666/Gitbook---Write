# SSH

Secure Shell is a cryptographic network protocol used for operating network services over an unsecured network. SSH provides for remote logins and command-line execution. SSH generally works over port 22, requiring a client to have SSH enabled and accepting connections.

SSH works via asymmetric encryption, with there being a public and private key involved. Each side would authenticate with each other, and once authenticated, a 'tunnel' is created between the client and the host, allowing for commands and output to be passed back and forth through this tunnel.

The tunnel basically would protect data in transit, meaning that the traffic is encrypted. SSH has strong encryption algorithms, like AES, to secure the communication. It has hashing algorithms to ensure that the integrity of data transmitted is maintainted as well.

SSH Keys can use one of a few encryption standards:

* RSA (preferred)
* Elliptic Curve Discrete Logarithm (ECDSA)
* EdDSA
* Diffie Hellman Algorithms&#x20;
* DSA (Deprecated)

Naturally, there are more secure algorithms than others, meaning that some keys can be cracked. SSH has its own fair share of vulnerabilities and configurations that can be enumerated.

## Enumeration

Just use this for auditing SSH stuff.

{% embed url="https://github.com/jtesta/ssh-audit" %}

### Commands

{% code overflow="wrap" %}
```bash
nmap -p22 <ip> -sC 
nmap -p22 <ip> -sV 
nmap -p22 <ip> --script ssh2-enum-algos
nmap -p22 <ip> --script ssh-hostkey --script-args ssh_hostkey=full
nmap -p22 <ip> --script ssh-auth-methods --script-args="ssh.user=root" 

#brute force
hydra -v -V -u -l root -P rockyou.txt -t 1 -u 10.10.10.10 ssh 
```
{% endcode %}

## Weak Keys

When generating keys through `ssh-keygen` there will always be some keys that are just weaker than others. Certain algorithms used are also weak and can be cracked easily. There have been tools developed to check whether an SSH key is weak or not.

{% embed url="https://github.com/mattbostock/sshkeycheck" %}

These weak keys are given by the Debian PRNG bug. Basically, there are types of keys generated by SSH that are predictable, because computers are only pseudo random and cannot generate true random keys.

As such, there are huge repositories of weak SSH keys available, where one can check and find a key pair that is weak and publicly available.

{% embed url="https://github.com/g0tmi1k/debian-ssh" %}

{% embed url="https://security-tracker.debian.org/tracker/CVE-2008-0166" %}

## Leaked Private Keys

If were to be able to find a private key through other vulnerabilities, such as RFI or LFI, then we can proceed to login as that user.

```bash
chmod 600 ssh_key
ssh -i ssh_key <user>@<host>
```

## Configurations

If we are already in a host, there are methods to exploit the system such that we can privilege escalate or something. Sometimes, there are misconfigurations, cronjobs, or other vulnerabilities that make it easy to exploit.

Here are the key files we want to read to find out more about the system

<pre><code>/etc/ssh_config
/etc/sshd_config
~/user/.ssh/authorized_keys
/etc/ssh_known_hosts
<strong>~/user/.ssh/known_hosts
</strong>~/user/.ssh/id_rsa</code></pre>

