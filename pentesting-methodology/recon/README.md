# Recon

## External

For External recon, we can rely on stuff that basically won't be detected by the target. How External Recon helps is when we are able to prepare better phishing campaigns and social engineering attacks with high success rates. To psychologically manipulate our target, we would first need to understand and get to know them via the Internet before launching our attacks.

We can use the following methods:

* Google Dorks
* Domains and DNS
* OSINT&#x20;
* Harvester
* Leaks

The goal here is to find more information:

<figure><img src="../../.gitbook/assets/image (278).png" alt=""><figcaption></figcaption></figure>

Examples here would use this website:

{% embed url="https://megacorpone.com" %}

This is a fake website put out by Offensive Security that allows for practicing of external recon. Feel free to use this domain to test out your skills. **Do not try these on websites you have no permission on**.&#x20;

### Google Dorks

> Google Dorks, otherwise known as Google Hacking, is a method that can be used to find security holes in the configuration and computer code that websites are using.
>
> _Taken from Wikipedia_

When we Google stuff, Google has keyword add-ons that can be used to filter certain things. This can be used to perhaps locate assets of a particular domain that we are looking for.&#x20;

There have been cases of corporation's entire database with sensitive customer information being accidentally indexable on search engines due to misconfugurations. Naturally, the first instinct should be to notify the company immediately about this, and let them rectify it. Whether or not other not so honest people have exploited this kind of vulnerability and have already stolen this data is not clear. Don't underestimate the power of Google Hacking!

Here are some of the keywords (not all):

```bash
cache:website address # shows us version of web page that Google has cached 
Info:domainname.com
"index of" "database.sql.zip # SQL dumps on the website, even in 
intitle: 'Index of' wp-admin # finds all indexable wp-admin pages
inurl: 'keyword' # finds all pages with keyword in url
```

There are too many keywords and combinations for Google Dorks to be listed here, but here are just a few of it for you to understand.

[Here](https://gist.github.com/sundowndev/283efaddbcf896ab405488330d1bbc06) are more keywords that are possible, and websites like ExpoloitDB are consistenly maintaining a database of possible Google Dorks to use:

{% embed url="https://www.exploit-db.com/google-hacking-database?category=9" %}

### Domains and DNS

Domains are basically the names for IP addresses (lind of), and DNS is used to resolve an IP address to a name or vice versa via looking at DNS records that exist for a website.

When we search the web for stuff like megacorpone.com, it would query the domain and find the IP address before being able to connect to it.

DNS records are basically like a file containing information about a particular domain, and we can use tools within Kali to enumerate these. To enumerate this, we can use `dnsrecon`.

<figure><img src="../../.gitbook/assets/image (319).png" alt=""><figcaption></figcaption></figure>

As we can see, this tool would find all the possible subdomains from a domain, where subdomains are basically like other websites that makes use of the root `metacorpone.com`.&#x20;

DNSRecon also attempts zone transfers for the subdomains it finds.

<figure><img src="../../.gitbook/assets/image (254) (1).png" alt=""><figcaption></figcaption></figure>

Zone transfers is the process of replicating a zone file to multiple DNS servers, and attackers can get access to the complete listing of all hosts part of the domain. This is achieved by copying the zone file from one DNS server to another DNS server, what attacks can do when zone transfers are possible is insert a forged DNS entry.&#x20;

This would essentially poison the DNS server, and perhaps it could contain an alternative IP destination for the same domain name, causing people to be redirected to the hacker's page which could be malicious and stuff. The DNS server would maintain this entry until the cache is refreshed.

Since DNS resolves a name to an IP address, we would also retrieve the public IP address of the domain. We can collect this information to find out all the IPs from the domain, and be able to find other IP addresses that previously used the domain (could be hidden pages!).

{% embed url="https://securitytrails.com/" %}

We can also find out more about CloudFlare, and be able to find other vulnerabilities or the hidden IP address of the main server.&#x20;

{% embed url="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/uncovering-cloudflare" %}

### OSINT

<figure><img src="../../.gitbook/assets/corporation.png" alt=""><figcaption></figcaption></figure>

This is an image from a common company's page, showing who their members are. From here, we can gain more insight into the company's members and key personnel we may want to target.&#x20;

Tools that we can use from here are stuff like **Social Mapper**. (**Use a throwaway Facebook account, if not you'll get banned or blocked**).

{% embed url="https://github.com/Greenwolf/social_mapper" %}

From here, we get to know these people better and enumerate all their social media accounts, to find out what they like, how they work, and especially how **aware they are of phishing**.&#x20;

Having a good understanding of who we are attacking would make targeted social engineering attacks all the more effective.&#x20;

OSINT need not only be about the person, but can also be about the company in general, and can be used in tandem with Google Dorks to build a better profile about the company we are targeting, such as their goals, focuses, mission and so on.

### Harvester

TheHarvester is a tool that acts as a wrapper for a variety of search engines and is used to find email accounts, subdomain names, virtual hosts, open ports / versions of software, names and so on from various public sources.&#x20;

<figure><img src="../../.gitbook/assets/image (303).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (285).png" alt=""><figcaption><p><em>Example output</em></p></figcaption></figure>

Basically, a huge web scraper that would allow us to scrape important information from numerous search engines. Think of it like an Auto-External Recon tool.

From here, we can start to find potential targets through emails and usernames from a company.

### Leaks

Leaks on companies happen all the time, and we can use this to our advantage. These leaks are commonly sold on the black market by actual hackers, and are low-hanging fruit for us.&#x20;

We can use tools to download all the public repositories from an organisation, such as `leakos`. We can use `pastos` to find more information on pastebins for a company. This can be useful in enumerating a company further and finding already present information. Passwords and the like.

{% embed url="https://github.com/carlospolop/Pastos" %}

{% embed url="https://github.com/carlospolop/Leakos" %}

Lastly, we can also make use of Google Dorks to search for this with specific keywords.

### Other Sources

This is just a simple compilation of OSINT that I sometimes use when trying to find out more about a company or a domain. There are way more techniques and stuff found here:

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/external-recon-methodology#public-cloud-assets" %}

You could also hang around the dark web in the hopes of someone posting some information regarding the company (only if you know how to use the Dark Web safely).

## Detectable

Assuming that you are given an internal pentest (meaning that we already start inside the network of the company), or you compromised your way in, the next step is to scan the networks and stuff for services and ports that are running, and then enumerate those further for potential vulnerabilities.

Things to find out:

* Is outdated and vulnerable software being used?
* Are web services properly secured with no hidden files?
* Do default or basic passwords work for logging in as administrators?
* Are there any noteworthy services that aren't supposed to be there?

These are just some of the things that I would aim to find out, and subsequently try to exploit. The main focus of which is service enumeration, and finding out what exists on the server.

### Port Scan

A port scan is a scan that checks for the services that are listening on the logical ports of a network. There are tyicall 65535 ports (which means there could be a theoretical 65535 services running on one server, which is insane).&#x20;

If stealth is not an issue, we can use `nmap`, which is a port scanner.

{% code overflow="wrap" %}
```bash
nmap <domain>/<IP>
nmap -Pn <IP> # remove ping from scan
nmap -p- <domain>/<IP> # scans all 65535 ports
sudo nmap -sC -sV -O <IP> # uses Nmap default scripts, enumerates version and OS of server
```
{% endcode %}

<figure><img src="../../.gitbook/assets/image (318).png" alt=""><figcaption><p><em>Example Nmap Output</em></p></figcaption></figure>

Service enumeration with -sV is called **banner grabbing**. This means that we are identifying the version of which the software runs and what we can do with it.

Why nmap is so noisy is because of the 3-way handshake over TCP.

<figure><img src="../../.gitbook/assets/image (334).png" alt=""><figcaption></figcaption></figure>

Nmap also pings the target to make sure it's alive before starting its scan, and this can be shut off using the `-Pn` flag.

Here are other flags for Nmap:

* \-n&#x20;
  * Never do DNS resolution of IP
* \-b
  * FTP Bounce scan which would send scan packets through the FTP server
  * FTP server acts as a proxy, and hides the source of packets
* \-sA
  * Maps out firewall rules
* \-sO
  * Scan is an IP protocol scan, more for enumerating type of IP protocols that a target system supports
* \-sV&#x20;
  * Initiate banner grabbing and enumerate software versions
* \-sI
  * Idle scan, to identify presence of zombies on target network
* \-Pn
  * Do not ping target
* \-T
  * \-T0 for paranoid scan
  * \-T1 for sneaky scan
  * \-T2 for polite scan
  * \-T3 is default normal scan
  * \-T4 aggressive scan
  * \-T5 insanely aggressive scan
* \--min-rate \<number>
  * Send \<number> packets per second
  * Don't set it too high else you'll crash the server.
* \-sU
  * initiate UDP scan to find UDP services
  * Nmap runs TCP scans by default, and UDP ports won't show up.
* \-sS
  * Fragment packets, which wouuld basically break packets up and send them out of order to bypass firewalls
* \-D
  * Add noise to firewalls by sending scans from a spoofed IP address
  * List of forged IP's will appear in logs along with attacker IP, making it hard for attacker to be located.
* \--source-port
  * Set the source port of scanning packets to bypass firewalls that block scans from other ports
* \--max-retries \<numbe>
  * Set the number of times nmap will send a probe to a certain port
* \--script=\<script name>
  * Run Nmap scripts on the target, such as find web vulnerabilities through --script=vuln
* \-sC
  * Run nmap default scripts.

This is just a rough introduction to Nmap, and there are others like it such as Masscan. More about Nmap can be read from here.

{% embed url="https://nmap.org/" %}

